# Development Dockerfile - Much faster builds
FROM python:3.13-slim

RUN groupadd --system --gid 999 nonroot \
 && useradd --system --gid 999 --uid 999 --create-home nonroot

WORKDIR /app

# Install basic dependencies first
RUN pip install --no-cache-dir fastapi[standard] uvicorn sqlmodel qdrant-client redis python-multipart python-dotenv psycopg2-binary asyncpg chardet pdfplumber

# Copy application code
COPY app/ /app/app/
COPY pyproject.toml /app/

USER nonroot
EXPOSE 8000

# Run with a simple mock embedding service (for development)
CMD ["python", "-m", "uvicorn", "app.app:app", "--host", "0.0.0.0", "--port", "8000"]